<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ch√° de Beb√™ ‚Ä¢ Convite & Lista</title>
  <meta name="description" content="Convite do ch√° de beb√™ + lista de presentes com imagens online, reserva por WhatsApp e PIX" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- SheetJS para ler o produtos.xlsx -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    :root { --brand:#e8a2b8; --brand2:#b7dfb9; --ink:#243041; }
    html, body { font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color: var(--ink); }
    .bg-baby {
      background-color:#fff6f8;
      background-image:
        radial-gradient(1200px 800px at 20% -10%, #ffe3ec 0%, rgba(255,227,236,0) 60%),
        radial-gradient(800px 600px at 110% 10%, #e0f5e3 0%, rgba(224,245,227,0) 60%),
        url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='180' height='180' viewBox='0 0 180 180'><g fill='none' stroke='%23a6d5a7' stroke-width='1.1' stroke-opacity='0.55'><path d='M20 80c10-22 30-35 50-40-8 12-10 25-6 38-14-1-28 2-44 12z'/><path d='M120 30c15 8 24 22 26 34-11-6-22-7-33-4 3-10 4-19 7-30z'/><path d='M120 130c-12 10-27 15-42 15 7-8 10-17 10-26 10 5 21 7 32 11z'/></g><g fill='%23d7f0d9' fill-opacity='0.5'><circle cx='30' cy='40' r='3'/><circle cx='150' cy='90' r='2.5'/><circle cx='80' cy='150' r='2.5'/></g></svg>");
      background-repeat: no-repeat, no-repeat, repeat;
      background-size: cover, cover, 180px 180px;
      background-attachment: fixed;
    }
    .card { background: white; border-radius: 1rem; box-shadow: 0 10px 30px rgba(30,41,59,.08); border: 1px solid rgba(232,162,184,.18); }
    .ribbon { position: relative; }
    .ribbon:before { content:""; position:absolute; inset:-2px; border-radius:1.05rem; padding:2px; background:linear-gradient(135deg, var(--brand), var(--brand2)); -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite: xor; mask-composite: exclude; }
  </style>
</head>
<body class="bg-baby">
  <!-- HERO / CONVITE -->
  <header class="px-4 sm:px-6 lg:px-8 pt-10 pb-6">
    <div class="max-w-5xl mx-auto card ribbon overflow-hidden">
      <div class="grid md:grid-cols-2">
        <div class="p-8 md:p-10">
          <p class="text-sm tracking-widest text-slate-500">VOC√ä EST√Å CONVIDADA(O)</p>
          <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold leading-tight mt-2">
            Ch√° de Beb√™ <span class="text-[var(--brand)]">(√© uma menina!)</span>
          </h1>
          <p class="mt-4 text-slate-600">Venha celebrar conosco a chegada da nossa beb√™! ü©∑üåø</p>

          <dl class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
            <div class="p-4 rounded-xl bg-white/60 border border-slate-200">
              <dt class="text-slate-500">Data & Hora</dt>
              <dd id="dtText" class="font-semibold">S√°bado, 12 de outubro, 15:30</dd>
            </div>
            <div class="p-4 rounded-xl bg-white/60 border border-slate-200">
              <dt class="text-slate-500">Local</dt>
              <dd class="font-semibold">Sal√£o de Festas ‚Äî Condom√≠nio</dd>
            </div>
            <div class="p-4 rounded-xl bg-white/60 border border-slate-200">
              <dt class="text-slate-500">Traje/Clima</dt>
              <dd class="font-semibold">Confort√°vel & alegre (tons claros/ros√©)</dd>
            </div>
            <div class="p-4 rounded-xl bg-white/60 border border-slate-200">
              <dt class="text-slate-500">Confirma√ß√£o</dt>
              <dd class="font-semibold">Confirme no WhatsApp üôè</dd>
            </div>
          </dl>

          <div class="mt-6 flex flex-wrap gap-3">
            <a id="rsvpBtn" href="#rsvp" class="inline-flex items-center justify-center rounded-xl px-5 py-3 text-white font-semibold" style="background:linear-gradient(135deg, var(--brand), var(--brand2));">
              Confirmar presen√ßa
            </a>
            <a href="#lista" class="inline-flex items-center justify-center rounded-xl px-5 py-3 border font-semibold border-slate-300 text-slate-700 hover:bg-white">
              Ver lista de presentes
            </a>
          </div>

          <div class="mt-6 text-sm text-slate-500">Falta <span id="countdown" class="font-semibold text-slate-700">‚Äî</span> para o grande dia!</div>
        </div>
        <div class="order-first md:order-last h-64 md:h-auto bg-[url('hero.jpeg')] bg-cover bg-center rounded-t-xl md:rounded-l-none md:rounded-r-xl"></div>
      </div>
    </div>
  </header>

  <main class="px-4 sm:px-6 lg:px-8 pb-24">
    <div class="max-w-5xl mx-auto space-y-10">

      <!-- PIX / PRESENTE EM DINHEIRO -->
      <section id="pix" class="card p-6 md:p-8">
        <h2 class="text-2xl font-bold">Quero presentear em PIX</h2>
        <p class="mt-2 text-slate-600">Se preferir, voc√™ pode ajudar com qualquer valor. üíñ</p>
        <div class="mt-4 grid sm:grid-cols-[1fr_auto] gap-4 items-center">
          <div>
            <div class="text-sm text-slate-500">Chave PIX</div>
            <div id="pixKey" class="text-lg font-semibold select-all break-all">SUA_CHAVE_PIX_AQUI</div>
          </div>
          <button class="px-4 py-2 rounded-lg font-semibold border border-slate-300 hover:bg-white" onclick="copyPix()">Copiar chave</button>
        </div>
        <div class="mt-3 text-xs text-slate-500">Banco: <span class="font-medium">Bradesco</span></div>
        <div class="mt-3 flex items-center gap-4">
          <img src="bradesco.png" alt="QR Code PIX" class="w-40 h-40 object-contain rounded-md border border-slate-200 bg-white" />
          <div class="text-xs text-slate-500">Voc√™ pode <strong>escanear o QR</strong> pelo app do banco ou usar a chave acima.</div>
        </div>
      </section>

      <!-- LISTA DE PRESENTES -->
      <section id="lista" class="card p-6 md:p-8">
        <div class="flex items-center justify-between gap-4 flex-wrap">
          <h2 class="text-2xl font-bold">Lista de Presentes</h2>
          <p class="text-slate-600 text-sm">Os itens s√£o lidos do arquivo <code>produtos.xlsx</code> (mesma pasta do index) e exibem <strong>imagens online</strong> da coluna <code>imagem</code>.</p>
        </div>

        <div class="mt-6 overflow-x-auto">
          <table class="min-w-full text-left text-sm" id="giftTable">
            <thead>
              <tr class="border-b bg-slate-50 text-slate-600">
                <th class="py-3 px-3">Foto</th>
                <th class="py-3 px-3">Item</th>
                <th class="py-3 px-3">Detalhes</th>
                <th class="py-3 px-3">Valor (R$)</th>
                <th class="py-3 px-3">Reservado?</th>
                <th class="py-3 px-3">A√ß√£o</th>
              </tr>
            </thead>
            <tbody id="giftTbody" class="divide-y"></tbody>
          </table>
        </div>
      </section>

      <!-- COMO CHEGAR / MAPA -->
      <section id="mapa" class="card p-6 md:p-8">
        <h2 class="text-2xl font-bold">Como chegar</h2>
        <p class="mt-2 text-slate-600">Clique para abrir no Google Maps.</p>
        <a id="mapLink" target="_blank" class="inline-flex mt-4 items-center justify-center rounded-xl px-5 py-3 text-white font-semibold" style="background:linear-gradient(135deg, var(--brand), var(--brand2));">
          Abrir no Google Maps
        </a>
      </section>

      <!-- RSVP -->
      <section id="rsvp" class="card p-6 md:p-8">
        <h2 class="text-2xl font-bold">Confirma√ß√£o de presen√ßa</h2>
        <p class="mt-2 text-slate-600">Confirme no WhatsApp para nos organizarmos melhor. Obrigado! üíô</p>
        <a id="whatsBtn" target="_blank" class="inline-flex mt-4 items-center justify-center rounded-xl px-5 py-3 text-white font-semibold" style="background:linear-gradient(135deg, var(--brand), var(--brand2));">
          Enviar mensagem no WhatsApp
        </a>
      </section>

    </div>
  </main>

  <footer class="text-center text-xs text-slate-500 pb-10">
    Feito com carinho ‚Äî ¬© <span id="ano"></span>
  </footer>

  <script>
    // === CONFIGUR√ÅVEL: edite aqui os dados do convite ===
    const CONFIG = {
      datetime: '2025-10-12T15:30:00',
      datetimeText: 'S√°bado, 12 de outubro, 15:30',
      mapsQuery: 'Residencial Nature Ville, Cabula, Salvador - BA',
      pixKey: 'SUA_CHAVE_PIX_AQUI',
      whatsapp: '5571999999999',
      rsvpText: 'Ol√°! Quero confirmar presen√ßa no Ch√° de Beb√™. Meu nome √©: ',
      reserveText: 'Ol√°! Quero reservar este presente do ch√° de beb√™: '
    };

    // === util: formatar n√∫mero BRL ===
    const fmtBRL = v => (v==null||v==='') ? '-' : Number(v).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

    // Placeholder SVG embutido para quando n√£o houver imagem
    const PLACEHOLDER_IMG = "data:image/svg+xml;utf8," + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='80' height='80'><rect width='100%' height='100%' fill='#f1f5f9'/><text x='50%' y='50%' text-anchor='middle' dominant-baseline='middle' font-size='11' fill='#9ca3af'>sem foto</text></svg>`);

    // Escapar HTML simples
    const esc = s => (s||'').toString().replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\\'':'&#39;'}[m]));

    // === countdown ===
    function startCountdown() {
      const el = document.getElementById('countdown');
      const target = new Date(CONFIG.datetime);
      function tick(){
        const now = new Date();
        let diff = Math.max(0, target - now);
        const d = Math.floor(diff / 86400000); diff -= d*86400000;
        const h = Math.floor(diff / 3600000);  diff -= h*3600000;
        const m = Math.floor(diff / 60000);    diff -= m*60000;
        const s = Math.floor(diff / 1000);
        el.textContent = `${d}d ${h}h ${m}m ${s}s`;
      }
      tick(); setInterval(tick, 1000);
    }

    // === PIX ===
    function copyPix(){
      navigator.clipboard.writeText(CONFIG.pixKey).then(()=>{
        alert('Chave PIX copiada!');
      });
    }

    // === construir links ===
    function buildLinks() {
      document.getElementById('dtText').textContent = CONFIG.datetimeText;
      document.getElementById('pixKey').textContent = CONFIG.pixKey;
      document.getElementById('mapLink').href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(CONFIG.mapsQuery)}`;
      document.getElementById('whatsBtn').href = `https://wa.me/${CONFIG.whatsapp}?text=${encodeURIComponent(CONFIG.rsvpText)}`;
      document.getElementById('rsvpBtn').href = `https://wa.me/${CONFIG.whatsapp}?text=${encodeURIComponent(CONFIG.rsvpText)}`;
      document.getElementById('ano').textContent = new Date().getFullYear();
    }

    // === TABELA: ler produtos.xlsx e renderizar ===
    const tbody = document.getElementById('giftTbody');
    const LOCAL_KEY = 'babyshower_reserved_v2';
    const reserved = JSON.parse(localStorage.getItem(LOCAL_KEY) || '{}');

    function rowTpl(item, idx){
      const isRes = !!reserved[item.nome];

      // higieniza URL da imagem (evita http -> mixed content)
      function cleanImageUrl(u){
        if(!u) return '';
        let s = String(u).trim();
        if (s.startsWith('http://')) s = 'https://' + s.slice(7);
        return s;
      }

      const imgRaw = cleanImageUrl(item.imagem);
      const fallbackUnsplash = 'https://source.unsplash.com/600x600?' + encodeURIComponent((item.nome||'bebe').replace(/[^a-zA-Z0-9\s]/g,''));
      const imgSrc = imgRaw || PLACEHOLDER_IMG;

      const imgTag = (src)=> `\n        <img src="${esc(src)}" alt="${esc(item.nome)}"\n             class=\"w-20 h-20 object-cover rounded-md border border-slate-200 bg-white\"\n             referrerpolicy=\"no-referrer\" loading=\"lazy\"\n             onerror=\"this.onerror=null; this.src='${fallbackUnsplash}'\"/>`;

      const imgEl = item.url
        ? `<a href="${esc(item.url)}" target="_blank" rel="noopener">${imgTag(imgSrc)}</a>`
        : imgTag(imgSrc);

      const reserveHref = `https://wa.me/${CONFIG.whatsapp}?text=${encodeURIComponent(CONFIG.reserveText)}${encodeURIComponent(item.nome)}%20-%20${encodeURIComponent(item.detalhe||'')}`;
      return `
        <tr class=\"align-top\">\n          <td class=\"py-3 px-3\">${imgEl}</td>\n          <td class=\"py-3 px-3 font-medium\">${esc(item.nome)}</td>\n          <td class=\"py-3 px-3 text-slate-600\">${esc(item.detalhe||'-')}</td>\n          <td class=\"py-3 px-3\">${fmtBRL(item.valor)}</td>\n          <td class=\"py-3 px-3\">\n            <button data-idx=\"${idx}\" class=\"toggleRes px-3 py-1 rounded-lg border ${isRes? 'bg-green-50 border-green-300 text-green-700' : 'border-slate-300 text-slate-700 hover:bg-white'}\">\n              ${isRes? 'Marcado (local)' : 'Marcar' }\n            </button>\n          </td>\n          <td class=\"py-3 px-3 space-x-2\">\n            <a target=\"_blank\" class=\"reserveLink inline-flex items-center justify-center rounded-lg px-3 py-1 text-white\" style=\"background:linear-gradient(135deg, var(--brand), var(--brand2));\" href=\"${reserveHref}\">\n              Reservar no WhatsApp\n            </a>\n            ${item.url ? `<a target=\"_blank\" href=\"${esc(item.url)}\" class=\"inline-flex items-center justify-center rounded-lg px-3 py-1 border border-slate-300 text-slate-700 hover:bg-white\">Ver produto</a>` : ''}\n          </td>\n        </tr>`;
    }

    function renderGiftTable(list){
      tbody.innerHTML = list.map((it,i)=>rowTpl(it,i)).join('');
      tbody.querySelectorAll('.toggleRes').forEach(btn=>{
        btn.addEventListener('click', e=>{
          const idx = e.currentTarget.getAttribute('data-idx');
          const item = list[idx];
          if (reserved[item.nome]) delete reserved[item.nome]; else reserved[item.nome] = true;
          localStorage.setItem(LOCAL_KEY, JSON.stringify(reserved));
          renderGiftTable(list);
        });
      })
    }

    async function loadFromXLSX(){
      // cache-buster para evitar cache do GitHub Pages
      const res = await fetch('produtos.xlsx?v=' + Date.now());
      if (!res.ok) throw new Error('Falha ao baixar produtos.xlsx');
      const arrayBuffer = await res.arrayBuffer();
      const workbook = XLSX.read(arrayBuffer, {type:'array'});
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      const rows = XLSX.utils.sheet_to_json(sheet, {defval:'', raw:true});

      // normaliza chaves (remove acento, espa√ßos) e mapeia para campos esperados
      const norm = (row)=>{
        const flat = {};
        for (const [k,v] of Object.entries(row)){
          const nk = String(k).trim().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');
          flat[nk] = v;
        }
        return {
          nome:    flat['nome'] || flat['item'] || '',
          detalhe: flat['detalhe'] || flat['descricao'] || flat['descricao'] || '',
          valor:   flat['valor'] || flat['preco'] || flat['preco'] || '',
          imagem:  flat['imagem'] || flat['image'] || flat['foto'] || '',
          url:     flat['url'] || flat['link'] || ''
        }
      };

      const list = rows.map(norm).filter(x=>x.nome);

      // log de diagn√≥stico no console para ajudar
      console.log('[Lista] itens carregados:', list.length);
      if (list.length) {
        console.log('[Lista] exemplo do campo imagem:', list[0].imagem);
      }
      return list;
    }

    async function bootGifts(){
      try{
        const list = await loadFromXLSX();
        renderGiftTable(list);
      }catch(err){
        console.error('Erro ao carregar/renderizar lista:', err);
      }
    }

    // init
    (function init(){
      document.getElementById('dtText').textContent = CONFIG.datetimeText;
      document.getElementById('pixKey').textContent = CONFIG.pixKey;
      document.getElementById('mapLink').href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(CONFIG.mapsQuery)}`;
      document.getElementById('whatsBtn').href = `https://wa.me/${CONFIG.whatsapp}?text=${encodeURIComponent(CONFIG.rsvpText)}`;
      document.getElementById('rsvpBtn').href = `https://wa.me/${CONFIG.whatsapp}?text=${encodeURIComponent(CONFIG.rsvpText)}`;
      document.getElementById('ano').textContent = new Date().getFullYear();

      startCountdown();
      bootGifts();
    })();
  </script>
</body>
</html>